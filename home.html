import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, FacebookAuthProvider, signInWithRedirect } from "firebase/auth";
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-database.js"></script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meals Matter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #4CAF50;
            padding: 20px;
            text-align: center;
            color: white;
        }
        nav {
            display: flex;
            justify-content: space-around;
            background-color: #333;
        }
        nav a {
            color: white;
            padding: 14px 20px;
            text-decoration: none;
            text-align: center;
        }
        nav a:hover {
            background-color: #ddd;
            color: black;
        }
        section {
            padding: 20px;
        }
        #map {
            height: 400px;
            width: 100%;
        }
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
    <!-- Google Maps API -->
    <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXh9iR3N4E5svMN6V93Kdd3poYfzMUZwc&callback=initMap">
    </script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>

</head>
<body>

    <!-- Header -->
    <header>
        <h1>Meals Matter</h1>
        <p>Connecting food providers with shelters and individuals in need</p>
    </header>

    <!-- Navigation -->
    <nav>
        <a href="home.html">Home</a>
        <a href="about.html">Our Mission</a>
        <a href="map.html">Map</a>
        <a href="createAccount.html">Sign Up/Login</a>
    </nav>

    <!-- About/Purpose Section -->
    <section id="about">
        <h2>About</h2>
        <p>This website helps reduce food waste by connecting local bakeries, grocery stores, and restaurants with shelters and individuals that need food assistance. Our goal is to minimize food waste and ensure that the food is distributed to those in need in our community.</p>
    </section>

    <!-- Google Maps Section -->
    <section id="map-section">
        <h2>Find Food Providers Nearby</h2>
        <div id="map"></div>
    </section>

    <!-- Create Account/Login Section -->
    <section id="account">
        <h2>Create Account or Login</h2>
        <form id="accountForm">
            <label for="email">Email:</label><br>
            <input type="email" id="email" required><br><br>
            
            <label for="password">Password:</label><br>
            <input type="password" id="password" required><br><br>
            
            <button type="button" onclick="signUp()">Sign Up</button>
            <button type="button" onclick="login()">Login</button>
            <button type="button" onclick = "googleSignIn()"> Sign In With Google</button>
        </form>
        <div id="accountStatus"></div>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Food Waste Reduction Website</p>
    </footer>

    <script>
        // Initialize Firebase (Use your Firebase credentials)
        const firebaseConfig = {
            apiKey: "YOUR_FIREBASE_API_KEY",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Initialize the Google Map
        function initMap() {
            const options = {
                zoom: 10,
                center: { lat: 40.4259, lng: -86.9081 }
            };

            const map = new google.maps.Map(document.getElementById('map'), options);

            // uses geolocation API to get user's current location
            // note: geolocation API may be off by one or two blocks
            if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // Update map center to user's current location
                map.setCenter(userLocation);

                // Place a marker at the user's current location
                new google.maps.Marker({
                    position: userLocation,
                    map: map,
                    title: 'Your Current Location'
                });
            },
            (error) => {
                console.error("Error getting location: ", error);
                // Fallback behavior if geolocation fails
            }
        );
    } else {
        console.error("Geolocation not supported by this browser.");
    }
            //const marker = new google.maps.Marker({
               // position: { lat: 40.4259, lng: -86.9081 },
                //map: map,
                //title: 'Food Provider Location'
            //});
        }


        // Firebase Authentication (Sign Up and Login)
        function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    document.getElementById('accountStatus').innerText = 'Account created successfully!';
                    const user = userCredential.user;
                    db.collection('users').doc(user.uid).set({
                        email: user.email,
                        userType: 'recipient', // Set this based on the type of user
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .catch(error => {
                    document.getElementById('accountStatus').innerText = 'Error: ' + error.message;
                });
        }

        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    document.getElementById('accountStatus').innerText = 'Logged in successfully!';
                })
                .catch(error => {
                    document.getElementById('accountStatus').innerText = 'Error: ' + error.message;
                });
        }

        function googleSignIn() {
    // Set up Google provider
    
    const provider = new firebase.auth.GoogleAuthProvider();

    // Sign in with a popup window
    auth.signInWithPopup(provider)
        .then((result) => {
            // Get user info from result
            const user = result.user;

            // Check if the user already exists in Firestore
            db.collection('users').doc(user.uid).get().then((doc) => {
                if (!doc.exists) {
                    // New user, save data in Firestore
                    db.collection('users').doc(user.uid).set({
                        email: user.email,
                        name: user.displayName,
                        profilePicture: user.photoURL,
                        userType: 'recipient', // Example field
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        document.getElementById('accountStatus').innerText = 'Google Sign-In successful, account created!';
                    }).catch((error) => {
                        console.error('Error saving user data:', error);
                    });
                } else {
                    // Existing user
                    document.getElementById('accountStatus').innerText = 'Welcome back, ' + user.displayName + '!';
                }
            }).catch((error) => {
                console.error("Error fetching user data:", error);
            });
        })
        .catch((error) => {
            document.getElementById('accountStatus').innerText = 'Google Sign-In failed: ' + error.message;
        });
}
    </script>
</body>
</html>
